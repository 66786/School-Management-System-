<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Excel Library -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        :root { --gold: #D4AF37; --dark: #1a1a1a; --light-gold: #F4E4C1; }
        body { background: linear-gradient(135deg, #0f0f0f 0%, #2a2a2a 100%); min-height: 100vh; }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #F4E4C1 100%); }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s; }
        .card:hover { box-shadow: 0 8px 15px rgba(212, 175, 55, 0.3); transform: translateY(-2px); }
        .stat-card { background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: white; border: 2px solid #D4AF37; }
        .btn-primary { background: linear-gradient(135deg, #D4AF37 0%, #F4E4C1 100%); color: #1a1a1a; font-weight: 600; padding: 10px 24px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(212, 175, 55, 0.4); }
        .btn-secondary { background: #1a1a1a; color: white; border: 2px solid #D4AF37; padding: 8px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .btn-secondary:hover { background: #2d2d2d; }
        .btn-danger { background: #ef4444; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .btn-danger:hover { background: #dc2626; }
        .nav-tab { padding: 12px 24px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; color: white; font-weight: 500; }
        .nav-tab:hover { border-bottom-color: #D4AF37; background: rgba(212, 175, 55, 0.1); }
        .nav-tab.active { border-bottom-color: #D4AF37; background: rgba(212, 175, 55, 0.2); color: #D4AF37; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 16px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; padding: 32px; margin: 20px; }
        .form-input { width: 100%; padding: 10px 14px; border: 2px solid #e0e0e0; border-radius: 8px; transition: all 0.3s; }
        .form-input:focus { outline: none; border-color: #D4AF37; box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1); }
        .table { width: 100%; border-collapse: collapse; }
        .table th { background: #1a1a1a; color: #D4AF37; padding: 12px; text-align: left; font-weight: 600; }
        .table td { padding: 12px; border-bottom: 1px solid #e0e0e0; }
        .table tr:hover { background: #f8f8f8; }
        .status-paid { background: #10b981; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-pending { background: #ef4444; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .attendance-present { background: #10b981; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; border: none; font-weight: 600; }
        .attendance-absent { background: #ef4444; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; border: none; font-weight: 600; }
        .print-area { display: none; }
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; display: block !important; }
        }
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
        .alert-danger { background: #fee; border-left: 4px solid #ef4444; color: #991b1b; }
        .alert-warning { background: #fef3c7; border-left: 4px solid #f59e0b; color: #92400e; }
        .alert-success { background: #d1fae5; border-left: 4px solid #10b981; color: #065f46; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .badge-gold { background: #D4AF37; color: #1a1a1a; }
        .scroll-smooth { scroll-behavior: smooth; }
        .logo-preview { max-width: 120px; max-height: 120px; object-fit: contain; }
        input[type="file"] { display: none; }
        .file-upload-label { display: inline-block; padding: 10px 20px; background: #1a1a1a; color: #D4AF37; border-radius: 8px; cursor: pointer; border: 2px solid #D4AF37; transition: all 0.3s; }
        .file-upload-label:hover { background: #2d2d2d; }
        .payment-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; }
        .payment-month { padding: 12px; text-align: center; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .payment-month:hover { transform: scale(1.05); }
        .class-tag { display: inline-flex; align-items: center; gap: 5px; background: #1a1a1a; color: #D4AF37; padding: 6px 12px; border-radius: 20px; margin: 4px; }
        .class-tag button { background: transparent; border: none; color: white; cursor: pointer; font-size: 14px; }
        .class-tag button:hover { color: #ef4444; }
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-card { background: white; border-radius: 16px; width: 100%; max-width: 400px; padding: 32px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .toggle-form { text-align: center; margin-top: 20px; color: #666; }
        .toggle-form a { color: #D4AF37; cursor: pointer; font-weight: 600; }
        .toggle-form a:hover { text-decoration: underline; }
    </style>
</head>
<body class="scroll-smooth">
    <!-- Login/Signup Container (Initially Visible) -->
    <div id="authContainer" class="login-container">
        <div class="login-card">
            <div class="text-center mb-8">
                <div class="flex justify-center mb-4">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='38' fill='%23D4AF37'/%3E%3Ctext x='40' y='55' font-size='42' text-anchor='middle' fill='%231a1a1a' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E" alt="School Logo">
                </div>
                <h2 class="text-2xl font-bold" style="color: #D4AF37;">School Management System</h2>
                <p class="text-gray-600">Secure Access Portal</p>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <h3 class="text-xl font-bold text-center mb-6">Login to Your Account</h3>
                <div>
                    <label class="block text-sm font-semibold mb-2">Email Address *</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="your.email@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Password *</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="rememberMe" class="w-4 h-4">
                    <label for="rememberMe" class="text-sm">Remember me</label>
                </div>
                <button type="submit" class="btn-primary w-full">üîë Login to Dashboard</button>
                <div id="loginError" class="alert alert-danger hidden">
                    <span>‚ùå</span>
                    <span id="loginErrorText">Invalid email or password</span>
                </div>
            </form>
            
            <!-- Signup Form (Hidden Initially) -->
            <form id="signupForm" class="space-y-4 hidden">
                <h3 class="text-xl font-bold text-center mb-6">Create New Account</h3>
                <div>
                    <label class="block text-sm font-semibold mb-2">Full Name *</label>
                    <input type="text" id="signupName" class="form-input" placeholder="John Doe" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Email Address *</label>
                    <input type="email" id="signupEmail" class="form-input" placeholder="your.email@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Password *</label>
                    <input type="password" id="signupPassword" class="form-input" placeholder="Minimum 6 characters" required minlength="6">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Confirm Password *</label>
                    <input type="password" id="signupConfirmPassword" class="form-input" placeholder="Re-enter password" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Role *</label>
                    <select id="signupRole" class="form-input" required>
                        <option value="">Select Role</option>
                        <option value="admin">Administrator</option>
                        <option value="teacher">Teacher</option>
                        <option value="staff">Staff</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary w-full">üìù Create Account</button>
                <div id="signupError" class="alert alert-danger hidden">
                    <span>‚ùå</span>
                    <span id="signupErrorText">Error creating account</span>
                </div>
                <div id="signupSuccess" class="alert alert-success hidden">
                    <span>‚úÖ</span>
                    <span>Account created successfully! Please login.</span>
                </div>
            </form>
            
            <div class="toggle-form">
                <span id="toggleText">Don't have an account?</span>
                <a onclick="toggleAuthForm()" id="toggleLink">Sign up here</a>
            </div>
        </div>
    </div>

    <!-- Main Application (Initially Hidden) -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-black text-white sticky top-0 z-50 shadow-lg" style="border-bottom: 3px solid #D4AF37;">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between py-4">
                    <div class="flex items-center gap-4">
                        <img id="headerLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Ccircle cx='30' cy='30' r='28' fill='%23D4AF37'/%3E%3Ctext x='30' y='40' font-size='32' text-anchor='middle' fill='%231a1a1a' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E" alt="School Logo" class="h-16 w-16 object-contain">
                        <div>
                            <h1 id="headerSchoolName" class="text-2xl font-bold" style="color: #D4AF37;">School Management System</h1>
                            <p class="text-sm text-gray-400">Excellence in Education</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <input type="text" id="globalSearch" placeholder="Search students, teachers..." class="form-input bg-gray-800 text-white border-gray-700 w-64">
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="text-right">
                                <p class="font-semibold" style="color: #D4AF37;" id="currentUserName">Admin</p>
                                <p class="text-xs text-gray-400" id="currentUserRole">Administrator</p>
                            </div>
                            <button onclick="exportToExcel()" class="btn-primary text-sm">üìä Export Excel</button>
                            <button onclick="logout()" class="btn-danger text-sm">Logout</button>
                        </div>
                    </div>
                </div>
                <nav class="flex gap-2 overflow-x-auto">
                    <div class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</div>
                    <div class="nav-tab" onclick="switchTab('students')">Students</div>
                    <div class="nav-tab" onclick="switchTab('attendance')">Attendance</div>
                    <div class="nav-tab" onclick="switchTab('finance')">Finance</div>
                    <div class="nav-tab" onclick="switchTab('teachers')">Teachers</div>
                    <div class="nav-tab" onclick="switchTab('reports')">Reports</div>
                    <div class="nav-tab" onclick="switchTab('settings')">Settings</div>
                </nav>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content">
                <!-- Clock and Date -->
                <div class="card p-6 mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold" id="currentTime">12:00:00 PM</h2>
                            <p class="text-gray-600" id="currentDate">Monday, January 1, 2024</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">Academic Year</p>
                            <p class="text-xl font-bold" style="color: #D4AF37;" id="academicYear">2024</p>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="stat-card card p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm mb-2">Total Students</p>
                                <h3 class="text-3xl font-bold" style="color: #D4AF37;" id="totalStudents">0</h3>
                                <p class="text-sm text-green-400 mt-2">‚Üë Active</p>
                            </div>
                            <div class="text-4xl" style="color: #D4AF37;">üë®‚Äçüéì</div>
                        </div>
                    </div>
                    <div class="stat-card card p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm mb-2">Total Teachers</p>
                                <h3 class="text-3xl font-bold" style="color: #D4AF37;" id="totalTeachers">0</h3>
                                <p class="text-sm text-blue-400 mt-2">Active Staff</p>
                            </div>
                            <div class="text-4xl" style="color: #D4AF37;">üë®‚Äçüè´</div>
                        </div>
                    </div>
                    <div class="stat-card card p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm mb-2">Today's Attendance</p>
                                <h3 class="text-3xl font-bold" style="color: #D4AF37;" id="todayPresent">0</h3>
                                <p class="text-sm text-gray-400 mt-2"><span id="todayAbsent">0</span> Absent</p>
                            </div>
                            <div class="text-4xl" style="color: #D4AF37;">üìä</div>
                        </div>
                    </div>
                    <div class="stat-card card p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm mb-2">Monthly Collection</p>
                                <h3 class="text-3xl font-bold" style="color: #D4AF37;" id="monthlyCollected">‡ß≥0</h3>
                                <p class="text-sm text-red-400 mt-2"><span id="monthlyPending">‡ß≥0</span> Pending</p>
                            </div>
                            <div class="text-4xl" style="color: #D4AF37;">üí∞</div>
                        </div>
                    </div>
                </div>

                <!-- Alerts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4" style="color: #1a1a1a;">üö® Immediate Alerts</h3>
                        <div id="alertsContainer">
                            <div class="alert alert-warning">
                                <span>‚ö†Ô∏è</span>
                                <span>No alerts at this moment</span>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4" style="color: #1a1a1a;">üìã Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="openModal('addStudentModal')" class="btn-primary text-sm">+ Add Student</button>
                            <button onclick="switchTab('attendance')" class="btn-secondary text-sm">Mark Attendance</button>
                            <button onclick="switchTab('finance')" class="btn-secondary text-sm">Collect Payment</button>
                            <button onclick="openModal('addTeacherModal')" class="btn-secondary text-sm">+ Add Teacher</button>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4" style="color: #1a1a1a;">üìà Recent Activity</h3>
                    <div id="recentActivity" class="space-y-3">
                        <p class="text-gray-500 text-sm">No recent activity</p>
                    </div>
                </div>
            </div>

            <!-- Students Tab -->
            <div id="studentsTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Student Management</h2>
                    <div class="flex gap-3">
                        <button onclick="openModal('importExcelModal')" class="btn-secondary">üì• Import Excel</button>
                        <button onclick="openModal('addStudentModal')" class="btn-primary">+ Add New Student</button>
                    </div>
                </div>

                <!-- Class Filter with ADD CLASS feature -->
                <div class="card p-4 mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-semibold">Manage Classes:</label>
                        <button onclick="openModal('manageClassesModal')" class="btn-secondary text-sm">Manage Classes</button>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-semibold mb-2">Filter by Class:</label>
                        <div id="classButtonsContainer">
                            <!-- Class buttons will be added by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Students Table -->
                <div class="card p-6">
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Roll</th>
                                    <th>Student ID</th>
                                    <th>Name (English)</th>
                                    <th>Name (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</th>
                                    <th>Class</th>
                                    <th>Mobile</th>
                                    <th>Monthly Fee</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody">
                                <tr>
                                    <td colspan="8" class="text-center text-gray-500">No students found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div id="attendanceTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Attendance Management</h2>
                    <div class="flex gap-3 items-center">
                        <input type="date" id="attendanceDate" class="form-input" style="width: auto;">
                        <select id="attendanceClass" class="form-input" style="width: auto;" onchange="loadAttendanceByClass()">
                            <option value="all">All Classes</option>
                            <!-- Classes will be added by JavaScript -->
                        </select>
                        <button onclick="saveAttendance()" class="btn-primary">üíæ Save Attendance</button>
                    </div>
                </div>
                <div class="card p-6">
                    <div id="attendanceContainer">
                        <p class="text-gray-500 text-center">Select a date and class to mark attendance</p>
                    </div>
                </div>
            </div>

            <!-- Finance Tab -->
            <div id="financeTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Financial Management</h2>
                    <div class="flex gap-3">
                        <button onclick="generateMonthlyInvoices()" class="btn-secondary">üîÑ Generate Monthly Invoices</button>
                        <button onclick="openModal('addExpenseModal')" class="btn-primary">+ Add Expense</button>
                    </div>
                </div>

                <!-- Financial Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="stat-card card p-6">
                        <p class="text-gray-400 text-sm mb-2">Total Revenue (This Month)</p>
                        <h3 class="text-2xl font-bold" style="color: #10b981;" id="totalRevenue">‡ß≥0</h3>
                    </div>
                    <div class="stat-card card p-6">
                        <p class="text-gray-400 text-sm mb-2">Total Expenses (This Month)</p>
                        <h3 class="text-2xl font-bold" style="color: #ef4444;" id="totalExpenses">‡ß≥0</h3>
                    </div>
                    <div class="stat-card card p-6">
                        <p class="text-gray-400 text-sm mb-2">Net Profit/Loss</p>
                        <h3 class="text-2xl font-bold" style="color: #D4AF37;" id="netProfit">‡ß≥0</h3>
                    </div>
                </div>

                <!-- Payment Management -->
                <div class="card p-6 mb-6">
                    <h3 class="text-xl font-bold mb-4">Student Payment Management</h3>
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Class</th>
                                    <th>Month</th>
                                    <th>Base Fee</th>
                                    <th>Additional</th>
                                    <th>Discount</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTableBody">
                                <tr>
                                    <td colspan="9" class="text-center text-gray-500">No payment records</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Expenses -->
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4">Expenses</h3>
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <tr>
                                    <td colspan="5" class="text-center text-gray-500">No expenses recorded</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Teachers Tab -->
            <div id="teachersTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Teacher Management</h2>
                    <div class="flex gap-3">
                        <button onclick="switchTeacherView('directory')" class="btn-primary" id="btnTeacherDirectory">üë®‚Äçüè´ Directory</button>
                        <button onclick="switchTeacherView('salary')" class="btn-secondary" id="btnTeacherSalary">üí∞ Salary Management</button>
                        <button onclick="openModal('addTeacherModal')" class="btn-primary">+ Add New Teacher</button>
                    </div>
                </div>

                <!-- Teacher Directory View -->
                <div id="teacherDirectoryView" class="card p-6">
                    <h3 class="text-xl font-bold mb-4">Teacher Directory</h3>
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Teacher ID</th>
                                    <th>Name</th>
                                    <th>Mobile</th>
                                    <th>Email</th>
                                    <th>Joining Date</th>
                                    <th>Monthly Salary</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="teachersTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-gray-500">No teachers found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Teacher Salary Management View -->
                <div id="teacherSalaryView" class="hidden">
                    <!-- Salary Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="stat-card card p-6">
                            <p class="text-gray-400 text-sm mb-2">Total Monthly Salaries</p>
                            <h3 class="text-2xl font-bold" style="color: #D4AF37;" id="totalMonthlySalaries">‡ß≥0</h3>
                        </div>
                        <div class="stat-card card p-6">
                            <p class="text-gray-400 text-sm mb-2">Paid This Month</p>
                            <h3 class="text-2xl font-bold" style="color: #10b981;" id="salariesPaidThisMonth">‡ß≥0</h3>
                        </div>
                        <div class="stat-card card p-6">
                            <p class="text-gray-400 text-sm mb-2">Pending This Month</p>
                            <h3 class="text-2xl font-bold" style="color: #ef4444;" id="salariesPendingThisMonth">‡ß≥0</h3>
                        </div>
                    </div>

                    <!-- Monthly Salary Management -->
                    <div class="card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Teacher Salary - <span id="salaryMonthDisplay"></span></h3>
                            <button onclick="generateMonthlySalaries()" class="btn-primary">üîÑ Generate Month Salaries</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Teacher Name</th>
                                        <th>Monthly Salary</th>
                                        <th>Bonus</th>
                                        <th>Total Amount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="teacherSalaryTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center text-gray-500">No salary records for this month</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Salary Payment History -->
                    <div class="card p-6 mt-6">
                        <h3 class="text-xl font-bold mb-4">Salary Payment History</h3>
                        <div class="overflow-x-auto">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Teacher Name</th>
                                        <th>Month/Year</th>
                                        <th>Salary</th>
                                        <th>Bonus</th>
                                        <th>Total Paid</th>
                                        <th>Payment Method</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="salaryHistoryTableBody">
                                    <tr>
                                        <td colspan="8" class="text-center text-gray-500">No payment history</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-white mb-6">Reports & Analytics</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Student Reports</h3>
                        <div class="space-y-3">
                            <button onclick="generateStudentReport()" class="btn-secondary w-full text-left">üìä Student Directory</button>
                            <button onclick="generateAttendanceReport()" class="btn-secondary w-full text-left">üìÖ Attendance Report</button>
                            <button onclick="generateClassWiseReport()" class="btn-secondary w-full text-left">üìã Class-wise Lists</button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Financial Reports</h3>
                        <div class="space-y-3">
                            <button onclick="generateFeeCollectionReport()" class="btn-secondary w-full text-left">üí∞ Fee Collection Summary</button>
                            <button onclick="generateOutstandingReport()" class="btn-secondary w-full text-left">‚ö†Ô∏è Outstanding Dues</button>
                            <button onclick="generateProfitLossReport()" class="btn-secondary w-full text-left">üìà Profit & Loss Statement</button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Teacher Reports</h3>
                        <div class="space-y-3">
                            <button onclick="generateTeacherDirectoryReport()" class="btn-secondary w-full text-left">üë®‚Äçüè´ Teacher Directory</button>
                            <button onclick="generateSalaryReport()" class="btn-secondary w-full text-left">üíµ Salary Payment Report</button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Quick Export</h3>
                        <div class="space-y-3">
                            <button onclick="exportToExcel()" class="btn-primary w-full">üì• Export All Data to Excel</button>
                            <button onclick="exportWithMultipleSheets()" class="btn-secondary w-full text-left">üìë Excel with Tabs (6 Sheets)</button>
                            <button onclick="backupAllData()" class="btn-secondary w-full text-left">üíæ Backup All Data</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-white mb-6">Settings</h2>

                <div class="card p-6 mb-6">
                    <h3 class="text-xl font-bold mb-4">School Information</h3>
                    <form onsubmit="saveSchoolSettings(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">School Name</label>
                                <input type="text" id="schoolName" class="form-input" placeholder="Enter school name">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">School Address</label>
                                <input type="text" id="schoolAddress" class="form-input" placeholder="Enter address">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Contact Number</label>
                                <input type="tel" id="schoolPhone" class="form-input" placeholder="Enter phone number">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Email</label>
                                <input type="email" id="schoolEmail" class="form-input" placeholder="Enter email">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold mb-2">School Logo</label>
                            <div class="flex items-center gap-4">
                                <img id="logoPreview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='55' fill='%23D4AF37'/%3E%3Ctext x='60' y='80' font-size='60' text-anchor='middle' fill='%231a1a1a' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E" class="logo-preview border-2 border-gray-300 rounded">
                                <label for="logoUpload" class="file-upload-label">
                                    üì§ Upload Logo
                                </label>
                                <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)">
                            </div>
                        </div>

                        <button type="submit" class="btn-primary">üíæ Save Settings</button>
                    </form>
                </div>

                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4">SMS Configuration</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">SMS Gateway API Key</label>
                            <input type="text" id="smsApiKey" class="form-input" placeholder="Enter API key">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Sender ID</label>
                            <input type="text" id="smsSender" class="form-input" placeholder="Enter sender ID">
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="smsEnabled" class="w-4 h-4">
                            <label for="smsEnabled" class="text-sm">Enable SMS Notifications</label>
                        </div>
                        <button onclick="saveSMSSettings()" class="btn-primary">üíæ Save SMS Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Student Modal -->
        <div id="addStudentModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold" id="studentModalTitle">Add New Student</h2>
                    <button onclick="closeModal('addStudentModal')" class="text-3xl">&times;</button>
                </div>

                <form onsubmit="saveStudent(event)" class="space-y-4">
                    <input type="hidden" id="studentEditMode" value="false">
                    <input type="hidden" id="studentEditId" value="">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Student ID *</label>
                            <input type="text" id="studentId" class="form-input" required placeholder="Enter unique ID (e.g. 2024-001)">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Roll Number *</label>
                            <input type="number" id="rollNumber" class="form-input" required placeholder="Enter Roll Number">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Student Name (English) *</label>
                            <input type="text" id="studentNameEn" class="form-input" required placeholder="Enter name in English">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Student Name (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ) *</label>
                            <input type="text" id="studentNameBn" class="form-input" required placeholder="‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶Ø‡¶º ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Father's Name (English) *</label>
                            <input type="text" id="fatherNameEn" class="form-input" required placeholder="Enter father's name">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Father's Name (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ) *</label>
                            <input type="text" id="fatherNameBn" class="form-input" required placeholder="‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Mother's Name (English) *</label>
                            <input type="text" id="motherNameEn" class="form-input" required placeholder="Enter mother's name">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Mother's Name (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ) *</label>
                            <input type="text" id="motherNameBn" class="form-input" required placeholder="‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Mobile Number *</label>
                            <input type="tel" id="studentMobile" class="form-input" required placeholder="01XXXXXXXXX">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Class *</label>
                            <select id="studentClass" class="form-input" required>
                                <option value="">Select Class</option>
                                <!-- Classes will be added by JavaScript -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Gender *</label>
                            <select id="studentGender" class="form-input" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Religion *</label>
                            <select id="studentReligion" class="form-input" required>
                                <option value="">Select Religion</option>
                                <option value="Islam">Islam</option>
                                <option value="Hinduism">Hinduism</option>
                                <option value="Christianity">Christianity</option>
                                <option value="Buddhism">Buddhism</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Admission Date *</label>
                            <input type="date" id="admissionDate" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Monthly Fee (‡ß≥) *</label>
                            <input type="number" id="monthlyFee" class="form-input" required placeholder="0" min="0">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2">Present Address *</label>
                        <textarea id="presentAddress" class="form-input" required rows="2" placeholder="Enter present address"></textarea>
                    </div>

                    <div class="flex items-center gap-2 mb-2">
                        <input type="checkbox" id="sameAddress" onchange="copySameAddress()">
                        <label for="sameAddress" class="text-sm">Permanent address same as present</label>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2">Permanent Address *</label>
                        <textarea id="permanentAddress" class="form-input" required rows="2" placeholder="Enter permanent address"></textarea>
                    </div>

                    <div class="flex gap-3 justify-end">
                        <button type="button" onclick="closeModal('addStudentModal')" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary" id="studentSubmitBtn">üíæ Save Student</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Teacher Modal -->
        <div id="addTeacherModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold" id="teacherModalTitle">Add New Teacher</h2>
                    <button onclick="closeModal('addTeacherModal')" class="text-3xl">&times;</button>
                </div>

                <form onsubmit="saveTeacher(event)" class="space-y-4">
                    <input type="hidden" id="teacherEditMode" value="false">
                    <input type="hidden" id="teacherEditId" value="">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Teacher Name *</label>
                            <input type="text" id="teacherName" class="form-input" required placeholder="Enter full name">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Mobile Number *</label>
                            <input type="tel" id="teacherMobile" class="form-input" required placeholder="01XXXXXXXXX">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Email</label>
                            <input type="email" id="teacherEmail" class="form-input" placeholder="teacher@school.com">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Gender *</label>
                            <select id="teacherGender" class="form-input" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Religion *</label>
                            <select id="teacherReligion" class="form-input" required>
                                <option value="">Select Religion</option>
                                <option value="Islam">Islam</option>
                                <option value="Hinduism">Hinduism</option>
                                <option value="Christianity">Christianity</option>
                                <option value="Buddhism">Buddhism</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Joining Date *</label>
                            <input type="date" id="teacherJoiningDate" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Education *</label>
                            <input type="text" id="teacherEducation" class="form-input" required placeholder="e.g., B.Ed, M.A">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Monthly Salary (‡ß≥) *</label>
                            <input type="number" id="teacherSalary" class="form-input" required placeholder="0" min="0">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2">Present Address *</label>
                        <textarea id="teacherPresentAddress" class="form-input" required rows="2"></textarea>
                    </div>

                    <div class="flex items-center gap-2 mb-2">
                        <input type="checkbox" id="teacherSameAddress" onchange="copyTeacherSameAddress()">
                        <label for="teacherSameAddress" class="text-sm">Permanent address same as present</label>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2">Permanent Address *</label>
                        <textarea id="teacherPermanentAddress" class="form-input" required rows="2"></textarea>
                    </div>

                    <div class="flex gap-3 justify-end">
                        <button type="button" onclick="closeModal('addTeacherModal')" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary" id="teacherSubmitBtn">üíæ Save Teacher</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manage Classes Modal -->
        <div id="manageClassesModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Manage Classes</h2>
                    <button onclick="closeModal('manageClassesModal')" class="text-3xl">&times;</button>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">Add New Class</h3>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="newClassNameInput" placeholder="Enter class name (e.g., Class 9)" class="form-input flex-1">
                        <button onclick="addNewClass()" class="btn-primary">+ Add Class</button>
                    </div>
                    <div id="classAddError" class="alert alert-danger hidden"></div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3">Existing Classes</h3>
                    <div id="classesList" class="space-y-2">
                        <!-- Classes will be listed here -->
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button onclick="closeModal('manageClassesModal')" class="btn-secondary">Close</button>
                </div>
            </div>
        </div>

        <!-- Payment Modal -->
        <div id="paymentModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Process Payment</h2>
                    <button onclick="closeModal('paymentModal')" class="text-3xl">&times;</button>
                </div>
                <form onsubmit="processPayment(event)" class="space-y-4">
                    <input type="hidden" id="paymentStudentId">
                    <input type="hidden" id="paymentMonth">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-sm font-semibold mb-2">Student Name</label><input type="text" id="paymentStudentName" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Month/Year</label><input type="text" id="paymentMonthDisplay" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Base Fee (‡ß≥)</label><input type="number" id="paymentBaseFee" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Additional Costs (‡ß≥)</label><input type="number" id="paymentAdditional" class="form-input" min="0" value="0" onchange="calculatePaymentTotal()"><input type="text" id="paymentAdditionalNote" class="form-input mt-2" placeholder="Reason (e.g., Exam fee, Books)"></div>
                        <div><label class="block text-sm font-semibold mb-2">Discount (‡ß≥)</label><input type="number" id="paymentDiscount" class="form-input" min="0" value="0" onchange="calculatePaymentTotal()"><input type="text" id="paymentDiscountNote" class="form-input mt-2" placeholder="Reason for discount"></div>
                        <div><label class="block text-sm font-semibold mb-2">Total Amount (‡ß≥)</label><input type="number" id="paymentTotal" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Payment Method *</label><select id="paymentMethod" class="form-input" required><option value="">Select Method</option><option value="Cash">Cash</option><option value="Bkash">Bkash</option><option value="Nagad">Nagad</option><option value="Bank Transfer">Bank Transfer</option><option value="Other">Other</option></select></div>
                        <div><label class="block text-sm font-semibold mb-2">Transaction ID</label><input type="text" id="paymentTransactionId" class="form-input" placeholder="Optional"></div>
                        <div><label class="block text-sm font-semibold mb-2">Manual Receipt Number</label><input type="text" id="manualReceiptNumber" class="form-input" placeholder="Enter receipt book number"></div>
                    </div>
                    <div class="flex gap-3 justify-end">
                        <button type="button" onclick="closeModal('paymentModal')" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">üí≥ Process Payment & Print Receipt</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Expense Modal -->
        <div id="addExpenseModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Add Expense</h2>
                    <button onclick="closeModal('addExpenseModal')" class="text-3xl">&times;</button>
                </div>
                <form onsubmit="saveExpense(event)" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-sm font-semibold mb-2">Date *</label><input type="date" id="expenseDate" class="form-input" required></div>
                        <div><label class="block text-sm font-semibold mb-2">Category *</label><select id="expenseCategory" class="form-input" required><option value="">Select Category</option><option value="Rent">Rent</option><option value="Electricity">Electricity</option><option value="Internet">Internet</option><option value="Supplies">Supplies</option><option value="Maintenance">Maintenance</option><option value="Transport">Transport</option><option value="Teacher Salary">Teacher Salary</option><option value="Other">Other</option></select></div>
                        <div><label class="block text-sm font-semibold mb-2">Amount (‡ß≥) *</label><input type="number" id="expenseAmount" class="form-input" required min="0"></div>
                        <div><label class="block text-sm font-semibold mb-2">Vendor/Payee</label><input type="text" id="expenseVendor" class="form-input" placeholder="Optional"></div>
                    </div>
                    <div><label class="block text-sm font-semibold mb-2">Description *</label><textarea id="expenseDescription" class="form-input" required rows="3"></textarea></div>
                    <div class="flex gap-3 justify-end">
                        <button type="button" onclick="closeModal('addExpenseModal')" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">üíæ Save Expense</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Pay Teacher Salary Modal -->
        <div id="paySalaryModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Pay Teacher Salary</h2>
                    <button onclick="closeModal('paySalaryModal')" class="text-3xl">&times;</button>
                </div>
                <form onsubmit="processTeacherSalary(event)" class="space-y-4">
                    <input type="hidden" id="salaryTeacherId">
                    <input type="hidden" id="salaryRecordId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-sm font-semibold mb-2">Teacher Name</label><input type="text" id="salaryTeacherName" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Month/Year</label><input type="text" id="salaryMonthYear" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Monthly Salary (‡ß≥)</label><input type="number" id="salaryBasicAmount" class="form-input" readonly></div>
                        <div><label class="block text-sm font-semibold mb-2">Bonus (‡ß≥)</label><input type="number" id="salaryBonus" class="form-input" min="0" value="0" onchange="calculateSalaryTotal()"><input type="text" id="salaryBonusReason" class="form-input mt-2" placeholder="Bonus reason (e.g., Festival, Performance)"></div>
                        <div class="md:col-span-2"><label class="block text-sm font-semibold mb-2">Total Amount (‡ß≥)</label><input type="number" id="salaryTotalAmount" class="form-input text-2xl font-bold" readonly style="color: #D4AF37; border: 2px solid #D4AF37;"></div>
                        <div><label class="block text-sm font-semibold mb-2">Payment Method *</label><select id="salaryPaymentMethod" class="form-input" required><option value="">Select Method</option><option value="Cash">Cash</option><option value="Bkash">Bkash</option><option value="Nagad">Nagad</option><option value="Bank Transfer">Bank Transfer</option><option value="Check">Check</option><option value="Other">Other</option></select></div>
                        <div><label class="block text-sm font-semibold mb-2">Transaction ID / Check No.</label><input type="text" id="salaryTransactionId" class="form-input" placeholder="Optional"></div>
                        <div class="md:col-span-2"><label class="block text-sm font-semibold mb-2">Payment Note</label><textarea id="salaryPaymentNote" class="form-input" rows="2" placeholder="Any additional notes"></textarea></div>
                    </div>
                    <div class="flex gap-3 justify-end">
                        <button type="button" onclick="closeModal('paySalaryModal')" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">üí≥ Process Payment & Print Slip</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Import Excel Modal -->
        <div id="importExcelModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Import Students from Excel</h2>
                    <button onclick="closeModal('importExcelModal')" class="text-3xl">&times;</button>
                </div>
                <div class="space-y-4">
                    <div class="alert alert-warning">
                        <span>‚ÑπÔ∏è</span>
                        <div>
                            <p class="font-semibold">Excel Import Instructions:</p>
                            <p class="text-sm">Your Excel file should have columns: Name (English), Name (Bangla), Father Name (EN), Father Name (BN), Mother Name (EN), Mother Name (BN), Mobile, Class, Gender, Religion, Present Address, Permanent Address, Monthly Fee</p>
                        </div>
                    </div>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                        <label for="excelUpload" class="file-upload-label cursor-pointer">üìä Click to Upload Excel File</label>
                        <input type="file" id="excelUpload" accept=".xlsx, .xls" onchange="handleExcelUpload(event)">
                        <p class="text-sm text-gray-500 mt-2">Supported formats: .xlsx, .xls</p>
                    </div>
                    <div id="excelPreview" class="hidden">
                        <h4 class="font-semibold mb-2">Preview:</h4>
                        <div class="overflow-x-auto max-h-64">
                            <table class="table text-sm">
                                <thead><tr id="excelPreviewHeader"></tr></thead>
                                <tbody id="excelPreviewBody"></tbody>
                            </table>
                        </div>
                        <div class="flex gap-3 mt-4">
                            <button onclick="importExcelData()" class="btn-primary">‚úÖ Import Data</button>
                            <button onclick="closeModal('importExcelModal')" class="btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Receipt Area -->
        <div class="print-area" id="printArea"></div>
    </div>

    <script>
        // ==================== AUTHENTICATION SYSTEM ====================
        let users = JSON.parse(localStorage.getItem('school_users')) || [
            {
                id: 'admin001',
                name: 'Administrator',
                email: 'admin@school.com',
                password: 'admin123',
                role: 'admin',
                createdAt: new Date().toISOString()
            }
        ];

        let currentUser = null;
        let isLoginForm = true;

        // Data Storage
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let teachers = JSON.parse(localStorage.getItem('teachers')) || [];
        let attendance = JSON.parse(localStorage.getItem('attendance')) || {};
        let payments = JSON.parse(localStorage.getItem('payments')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let salaryPayments = JSON.parse(localStorage.getItem('salaryPayments')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            schoolName: 'School Management System',
            schoolAddress: '',
            schoolPhone: '',
            schoolEmail: '',
            schoolLogo: '',
            smsEnabled: false,
            smsApiKey: '',
            smsSender: '',
            academicYear: new Date().getFullYear()
        };

        // Custom Classes Storage
        let customClasses = JSON.parse(localStorage.getItem('customClasses')) || ['Play', 'Nursery', 'KG', '1', '2', '3', '4', '5', '6', '7', '8'];

        let currentFilter = 'all';
        let currentTeacherView = 'directory';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showMainApp();
                } catch (e) {
                    console.log('No saved user session');
                }
            }
            
            updateClock();
            setInterval(updateClock, 1000);
        });

        // ==================== AUTH FUNCTIONS ====================
        function toggleAuthForm() {
            isLoginForm = !isLoginForm;
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const toggleText = document.getElementById('toggleText');
            const toggleLink = document.getElementById('toggleLink');
            
            if (isLoginForm) {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                toggleText.textContent = "Don't have an account?";
                toggleLink.textContent = "Sign up here";
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                toggleText.textContent = "Already have an account?";
                toggleLink.textContent = "Login here";
                // Clear errors
                document.getElementById('signupError').classList.add('hidden');
                document.getElementById('signupSuccess').classList.add('hidden');
            }
        }

        // Handle Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            // Find user
            const user = users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showMainApp();
            } else {
                errorDiv.classList.remove('hidden');
                errorDiv.querySelector('span:last-child').textContent = 'Invalid email or password';
            }
        });

        // Handle Signup
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const role = document.getElementById('signupRole').value;
            
            const errorDiv = document.getElementById('signupError');
            const successDiv = document.getElementById('signupSuccess');
            
            // Validation
            if (password !== confirmPassword) {
                errorDiv.classList.remove('hidden');
                errorDiv.querySelector('span:last-child').textContent = 'Passwords do not match';
                return;
            }
            
            if (password.length < 6) {
                errorDiv.classList.remove('hidden');
                errorDiv.querySelector('span:last-child').textContent = 'Password must be at least 6 characters';
                return;
            }
            
            // Check if email already exists
            if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
                errorDiv.classList.remove('hidden');
                errorDiv.querySelector('span:last-child').textContent = 'This email already has an account. Please login.';
                return;
            }
            
            // Create new user
            const newUser = {
                id: 'user_' + Date.now(),
                name: name,
                email: email,
                password: password,
                role: role,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('school_users', JSON.stringify(users));
            
            // Show success and switch to login
            errorDiv.classList.add('hidden');
            successDiv.classList.remove('hidden');
            
            // Clear form
            e.target.reset();
            
            // Auto switch to login after 2 seconds
            setTimeout(() => {
                successDiv.classList.add('hidden');
                toggleAuthForm();
            }, 2000);
        });

        function showMainApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info in header
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            
            // Initialize app
            loadDashboard();
            loadSettings();
            document.getElementById('attendanceDate').valueAsDate = new Date();
            document.getElementById('expenseDate').valueAsDate = new Date();
            document.getElementById('admissionDate').valueAsDate = new Date();
            document.getElementById('teacherJoiningDate').valueAsDate = new Date();
            
            updateClassButtons();
            updateClassSelects();
            loadClassesList();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('authContainer').classList.remove('hidden');
                
                // Reset forms
                document.getElementById('loginForm').reset();
                document.getElementById('loginError').classList.add('hidden');
                
                // Show login form
                if (!isLoginForm) {
                    toggleAuthForm();
                }
            }
        }

        // ==================== CLASS MANAGEMENT FUNCTIONS ====================
        function loadClassesList() {
            const container = document.getElementById('classesList');
            if (!container) return;
            
            if (customClasses.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">No classes added yet</p>';
                return;
            }
            
            container.innerHTML = customClasses.map(cls => `
                <div class="class-tag">
                    <span>${cls}</span>
                    <button onclick="editClassName('${cls}')" title="Edit">‚úèÔ∏è</button>
                    <button onclick="deleteClass('${cls}')" title="Delete">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function addNewClass() {
            const input = document.getElementById('newClassNameInput');
            const className = input.value.trim();
            const errorDiv = document.getElementById('classAddError');
            
            if (!className) {
                errorDiv.textContent = 'Please enter a class name';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Check for duplicates
            if (customClasses.includes(className)) {
                errorDiv.textContent = `Class "${className}" already exists`;
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Add class
            customClasses.push(className);
            localStorage.setItem('customClasses', JSON.stringify(customClasses));
            
            // Update UI
            input.value = '';
            errorDiv.classList.add('hidden');
            updateClassButtons();
            updateClassSelects();
            loadClassesList();
            
            addActivity(`New class added: ${className}`);
            alert(`Class "${className}" added successfully!`);
        }

        function editClassName(oldName) {
            const newName = prompt(`Edit class name:\nCurrent: ${oldName}\n\nEnter new name:`, oldName);
            
            if (!newName || newName.trim() === '' || newName === oldName) {
                return;
            }
            
            const className = newName.trim();
            
            // Check for duplicates
            if (customClasses.includes(className)) {
                alert(`Class "${className}" already exists`);
                return;
            }
            
            // Update in customClasses array
            const index = customClasses.indexOf(oldName);
            if (index !== -1) {
                customClasses[index] = className;
                localStorage.setItem('customClasses', JSON.stringify(customClasses));
                
                // Update all students with this class
                students.forEach(student => {
                    if (student.class === oldName) {
                        student.class = className;
                    }
                });
                localStorage.setItem('students', JSON.stringify(students));
                
                // Update UI
                updateClassButtons();
                updateClassSelects();
                loadClassesList();
                loadStudentsTable();
                
                addActivity(`Class renamed: ${oldName} ‚Üí ${className}`);
                alert(`Class renamed successfully!\nAll students in ${oldName} are now in ${className}`);
            }
        }

        function deleteClass(className) {
            // Check if any students are in this class
            const studentsInClass = students.filter(s => s.class === className);
            
            if (studentsInClass.length > 0) {
                const moveTo = prompt(`Cannot delete class "${className}" because it has ${studentsInClass.length} students.\n\nEnter a class to move these students to (or type "DELETE ALL" to delete class and students):`);
                
                if (!moveTo) return;
                
                if (moveTo.toUpperCase() === 'DELETE ALL') {
                    if (!confirm(`WARNING: This will delete class "${className}" AND ALL ${studentsInClass.length} STUDENTS in it! This cannot be undone.`)) {
                        return;
                    }
                    
                    // Delete all students in this class
                    students = students.filter(s => s.class !== className);
                    localStorage.setItem('students', JSON.stringify(students));
                } else if (customClasses.includes(moveTo)) {
                    // Move students to new class
                    students.forEach(student => {
                        if (student.class === className) {
                            student.class = moveTo;
                        }
                    });
                    localStorage.setItem('students', JSON.stringify(students));
                    alert(`${studentsInClass.length} students moved from ${className} to ${moveTo}`);
                } else {
                    alert(`Class "${moveTo}" does not exist`);
                    return;
                }
            }
            
            // Remove class
            customClasses = customClasses.filter(c => c !== className);
            localStorage.setItem('customClasses', JSON.stringify(customClasses));
            
            // Update UI
            updateClassButtons();
            updateClassSelects();
            loadClassesList();
            loadStudentsTable();
            
            addActivity(`Class deleted: ${className}`);
            alert(`Class "${className}" deleted successfully`);
        }

        function updateClassButtons() {
            const container = document.getElementById('classButtonsContainer');
            if (!container) return;
            
            container.innerHTML = `
                <button onclick="filterStudentsByClass('all')" class="btn-primary text-sm class-filter active">All Classes</button>
                ${customClasses.map(cls => `
                    <button onclick="filterStudentsByClass('${cls}')" class="btn-secondary text-sm class-filter">${cls}</button>
                `).join('')}
            `;
        }

        function updateClassSelects() {
            // Update student class select
            const studentSelect = document.getElementById('studentClass');
            if (studentSelect) {
                const currentValue = studentSelect.value;
                studentSelect.innerHTML = `<option value="">Select Class</option>
                    ${customClasses.map(cls => `<option value="${cls}">${cls}</option>`).join('')}`;
                if (currentValue && customClasses.includes(currentValue)) {
                    studentSelect.value = currentValue;
                }
            }
            
            // Update attendance class select
            const attendanceSelect = document.getElementById('attendanceClass');
            if (attendanceSelect) {
                const currentValue = attendanceSelect.value;
                attendanceSelect.innerHTML = `<option value="all">All Classes</option>
                    ${customClasses.map(cls => `<option value="${cls}">${cls}</option>`).join('')}`;
                if (currentValue && (currentValue === 'all' || customClasses.includes(currentValue))) {
                    attendanceSelect.value = currentValue;
                }
            }
        }

        // ==================== ORIGINAL FUNCTIONS ====================
        function updateClock() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            event.target.classList.add('active');
            if (tabName === 'students') {
                loadStudentsTable();
            } else if (tabName === 'finance') {
                loadFinanceData();
            } else if (tabName === 'teachers') {
                loadTeachersData();
            } else if (tabName === 'attendance') {
                loadAttendanceByClass();
            }
        }

        function filterStudentsByClass(className) {
            currentFilter = className;
            document.querySelectorAll('.class-filter').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            event.target.classList.remove('btn-secondary');
            event.target.classList.add('btn-primary');
            loadStudentsTable();
        }

        function loadStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            let filteredStudents = students;
            if (currentFilter !== 'all') {
                filteredStudents = students.filter(s => s.class === currentFilter);
            }
            if (filteredStudents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-gray-500">No students found</td></tr>';
                return;
            }
            tbody.innerHTML = filteredStudents.map(student => `
                <tr>
                    <td>${student.roll}</td>
                    <td><span class="badge badge-gold">${student.id}</span></td>
                    <td class="font-semibold">${student.nameEn}</td>
                    <td>${student.nameBn}</td>
                    <td>Class ${student.class}</td>
                    <td>${student.mobile}</td>
                    <td>‡ß≥${student.monthlyFee}</td>
                    <td>
                        <button onclick="editStudent('${student.id}')" class="btn-primary text-xs px-3 py-1">Edit</button>
                        <button onclick="viewStudentProfile('${student.id}')" class="btn-secondary text-xs px-3 py-1">View</button>
                        <button onclick="deleteStudent('${student.id}')" class="btn-danger text-xs px-3 py-1">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            // Fill modal with student data
            document.getElementById('studentModalTitle').textContent = 'Edit Student';
            document.getElementById('studentEditMode').value = 'true';
            document.getElementById('studentEditId').value = studentId;
            document.getElementById('studentId').value = student.id;
            document.getElementById('studentId').readOnly = true;
            document.getElementById('rollNumber').value = student.roll;
            document.getElementById('studentNameEn').value = student.nameEn;
            document.getElementById('studentNameBn').value = student.nameBn;
            document.getElementById('fatherNameEn').value = student.fatherNameEn;
            document.getElementById('fatherNameBn').value = student.fatherNameBn;
            document.getElementById('motherNameEn').value = student.motherNameEn;
            document.getElementById('motherNameBn').value = student.motherNameBn;
            document.getElementById('studentMobile').value = student.mobile;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentGender').value = student.gender;
            document.getElementById('studentReligion').value = student.religion;
            document.getElementById('admissionDate').value = student.admissionDate;
            document.getElementById('monthlyFee').value = student.monthlyFee;
            document.getElementById('presentAddress').value = student.presentAddress;
            document.getElementById('permanentAddress').value = student.permanentAddress;
            document.getElementById('studentSubmitBtn').textContent = 'üíæ Update Student';
            
            openModal('addStudentModal');
        }

        function saveStudent(event) {
            event.preventDefault();
            
            const isEdit = document.getElementById('studentEditMode').value === 'true';
            const studentId = isEdit ? document.getElementById('studentEditId').value : document.getElementById('studentId').value;
            const studentClass = document.getElementById('studentClass').value;
            const rollNumber = parseInt(document.getElementById('rollNumber').value);
            const idInput = document.getElementById('studentId').value;

            if (!studentId || !rollNumber) {
                alert('Please enter both Student ID and Roll Number');
                return;
            }

            if (isEdit) {
                // Update existing student
                const studentIndex = students.findIndex(s => s.id === studentId);
                if (studentIndex === -1) return;
                
                // Check if roll number exists in same class (excluding current student)
                const rollExists = students.some(s => 
                    s.class === studentClass && 
                    s.roll === rollNumber && 
                    s.id !== studentId
                );
                
                if (rollExists) {
                    alert(`Error: Roll Number ${rollNumber} already exists in Class ${studentClass}.`);
                    return;
                }
                
                students[studentIndex] = {
                    ...students[studentIndex],
                    nameEn: document.getElementById('studentNameEn').value,
                    nameBn: document.getElementById('studentNameBn').value,
                    fatherNameEn: document.getElementById('fatherNameEn').value,
                    fatherNameBn: document.getElementById('fatherNameBn').value,
                    motherNameEn: document.getElementById('motherNameEn').value,
                    motherNameBn: document.getElementById('motherNameBn').value,
                    mobile: document.getElementById('studentMobile').value,
                    class: studentClass,
                    roll: rollNumber,
                    gender: document.getElementById('studentGender').value,
                    religion: document.getElementById('studentReligion').value,
                    admissionDate: document.getElementById('admissionDate').value,
                    monthlyFee: parseFloat(document.getElementById('monthlyFee').value),
                    presentAddress: document.getElementById('presentAddress').value,
                    permanentAddress: document.getElementById('permanentAddress').value,
                    updatedAt: new Date().toISOString()
                };
                
                addActivity(`Student updated: ${students[studentIndex].nameEn}`);
                alert('Student updated successfully!');
            } else {
                // Add new student
                if (students.some(s => s.id === idInput)) {
                    alert('Error: Student ID already exists. Please use a unique ID.');
                    return;
                }

                if (students.some(s => s.class === studentClass && s.roll === rollNumber)) {
                    alert(`Error: Roll Number ${rollNumber} already exists in Class ${studentClass}.`);
                    return;
                }

                const student = {
                    id: idInput,
                    nameEn: document.getElementById('studentNameEn').value,
                    nameBn: document.getElementById('studentNameBn').value,
                    fatherNameEn: document.getElementById('fatherNameEn').value,
                    fatherNameBn: document.getElementById('fatherNameBn').value,
                    motherNameEn: document.getElementById('motherNameEn').value,
                    motherNameBn: document.getElementById('motherNameBn').value,
                    mobile: document.getElementById('studentMobile').value,
                    class: studentClass,
                    roll: rollNumber,
                    gender: document.getElementById('studentGender').value,
                    religion: document.getElementById('studentReligion').value,
                    admissionDate: document.getElementById('admissionDate').value,
                    monthlyFee: parseFloat(document.getElementById('monthlyFee').value),
                    presentAddress: document.getElementById('presentAddress').value,
                    permanentAddress: document.getElementById('permanentAddress').value,
                    createdAt: new Date().toISOString()
                };

                students.push(student);
                generatePaymentsForStudent(student);
                addActivity(`New student added: ${student.nameEn} (${student.class})`);
                alert('Student added successfully!');
            }

            localStorage.setItem('students', JSON.stringify(students));
            closeModal('addStudentModal');
            resetStudentForm();
            loadStudentsTable();
            loadDashboard();
        }

        function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student? This will also delete all their payment records.')) return;
            students = students.filter(s => s.id !== studentId);
            payments = payments.filter(p => p.studentId !== studentId);
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('payments', JSON.stringify(payments));
            addActivity('Student deleted');
            loadStudentsTable();
            loadDashboard();
        }

        function loadTeachersTable() {
            const tbody = document.getElementById('teachersTableBody');
            if (teachers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">No teachers found</td></tr>';
                return;
            }
            tbody.innerHTML = teachers.map(teacher => `
                <tr>
                    <td><span class="badge badge-gold">${teacher.id}</span></td>
                    <td class="font-semibold">${teacher.name}</td>
                    <td>${teacher.mobile}</td>
                    <td>${teacher.email || 'N/A'}</td>
                    <td>${new Date(teacher.joiningDate).toLocaleDateString()}</td>
                    <td class="font-bold">‡ß≥${teacher.salary}</td>
                    <td>
                        <button onclick="editTeacher('${teacher.id}')" class="btn-primary text-xs px-3 py-1">Edit</button>
                        <button onclick="deleteTeacher('${teacher.id}')" class="btn-danger text-xs px-3 py-1">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function editTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (!teacher) return;
            
            // Fill modal with teacher data
            document.getElementById('teacherModalTitle').textContent = 'Edit Teacher';
            document.getElementById('teacherEditMode').value = 'true';
            document.getElementById('teacherEditId').value = teacherId;
            document.getElementById('teacherName').value = teacher.name;
            document.getElementById('teacherMobile').value = teacher.mobile;
            document.getElementById('teacherEmail').value = teacher.email || '';
            document.getElementById('teacherGender').value = teacher.gender;
            document.getElementById('teacherReligion').value = teacher.religion;
            document.getElementById('teacherJoiningDate').value = teacher.joiningDate;
            document.getElementById('teacherEducation').value = teacher.education;
            document.getElementById('teacherSalary').value = teacher.salary;
            document.getElementById('teacherPresentAddress').value = teacher.presentAddress;
            document.getElementById('teacherPermanentAddress').value = teacher.permanentAddress;
            document.getElementById('teacherSubmitBtn').textContent = 'üíæ Update Teacher';
            
            openModal('addTeacherModal');
        }

        function saveTeacher(event) {
            event.preventDefault();
            
            const isEdit = document.getElementById('teacherEditMode').value === 'true';
            const teacherId = isEdit ? document.getElementById('teacherEditId').value : 'TCH' + Date.now();

            if (isEdit) {
                // Update existing teacher
                const teacherIndex = teachers.findIndex(t => t.id === teacherId);
                if (teacherIndex === -1) return;
                
                teachers[teacherIndex] = {
                    ...teachers[teacherIndex],
                    name: document.getElementById('teacherName').value,
                    mobile: document.getElementById('teacherMobile').value,
                    email: document.getElementById('teacherEmail').value,
                    gender: document.getElementById('teacherGender').value,
                    religion: document.getElementById('teacherReligion').value,
                    joiningDate: document.getElementById('teacherJoiningDate').value,
                    education: document.getElementById('teacherEducation').value,
                    salary: parseFloat(document.getElementById('teacherSalary').value),
                    presentAddress: document.getElementById('teacherPresentAddress').value,
                    permanentAddress: document.getElementById('teacherPermanentAddress').value,
                    updatedAt: new Date().toISOString()
                };
                
                addActivity(`Teacher updated: ${teachers[teacherIndex].name}`);
                alert('Teacher updated successfully!');
            } else {
                // Add new teacher
                const teacher = {
                    id: teacherId,
                    name: document.getElementById('teacherName').value,
                    mobile: document.getElementById('teacherMobile').value,
                    email: document.getElementById('teacherEmail').value,
                    gender: document.getElementById('teacherGender').value,
                    religion: document.getElementById('teacherReligion').value,
                    joiningDate: document.getElementById('teacherJoiningDate').value,
                    education: document.getElementById('teacherEducation').value,
                    salary: parseFloat(document.getElementById('teacherSalary').value),
                    presentAddress: document.getElementById('teacherPresentAddress').value,
                    permanentAddress: document.getElementById('teacherPermanentAddress').value,
                    createdAt: new Date().toISOString()
                };

                teachers.push(teacher);
                addActivity(`New teacher added: ${teacher.name}`);
                alert('Teacher added successfully!');
            }

            localStorage.setItem('teachers', JSON.stringify(teachers));
            closeModal('addTeacherModal');
            resetTeacherForm();
            loadTeachersTable();
            loadDashboard();
        }

        function deleteTeacher(teacherId) {
            if (!confirm('Are you sure you want to delete this teacher? This will also delete their salary records.')) return;
            teachers = teachers.filter(t => t.id !== teacherId);
            salaryPayments = salaryPayments.filter(s => s.teacherId !== teacherId);
            localStorage.setItem('teachers', JSON.stringify(teachers));
            localStorage.setItem('salaryPayments', JSON.stringify(salaryPayments));
            loadTeachersTable();
            loadDashboard();
        }

        function resetStudentForm() {
            document.getElementById('studentModalTitle').textContent = 'Add New Student';
            document.getElementById('studentEditMode').value = 'false';
            document.getElementById('studentEditId').value = '';
            document.getElementById('studentId').readOnly = false;
            document.getElementById('studentSubmitBtn').textContent = 'üíæ Save Student';
            event.target.reset();
            document.getElementById('admissionDate').valueAsDate = new Date();
        }

        function resetTeacherForm() {
            document.getElementById('teacherModalTitle').textContent = 'Add New Teacher';
            document.getElementById('teacherEditMode').value = 'false';
            document.getElementById('teacherEditId').value = '';
            document.getElementById('teacherSubmitBtn').textContent = 'üíæ Save Teacher';
            event.target.reset();
            document.getElementById('teacherJoiningDate').valueAsDate = new Date();
        }

        // ==================== MODAL FUNCTIONS ====================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'addStudentModal') resetStudentForm();
            if (modalId === 'addTeacherModal') resetTeacherForm();
        }

        // ==================== OTHER ORIGINAL FUNCTIONS ====================
        // Note: These are placeholders. You should copy your original functions here.
        // I'm including only the essential ones to keep the code length manageable.

        function loadDashboard() {
            // Your original loadDashboard function
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('totalTeachers').textContent = teachers.length;
            // Add more dashboard loading logic here
        }

        function addActivity(message) {
            // Your original addActivity function
            console.log('Activity:', message);
        }

        function generatePaymentsForStudent(student) {
            // Your original generatePaymentsForStudent function
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth();
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
            for (let i = 0; i <= currentMonth; i++) {
                const payment = {
                    id: 'PAY' + Date.now() + i,
                    studentId: student.id,
                    studentName: student.nameEn,
                    class: student.class,
                    month: months[i],
                    year: currentYear,
                    baseFee: student.monthlyFee,
                    additional: 0,
                    additionalNote: '',
                    discount: 0,
                    discountNote: '',
                    total: student.monthlyFee,
                    status: 'pending',
                    paymentMethod: '',
                    transactionId: '',
                    paidDate: null,
                    receiptNumber: ''
                };
                payments.push(payment);
            }
            localStorage.setItem('payments', JSON.stringify(payments));
        }

        function viewStudentProfile(studentId) {
            // Your original viewStudentProfile function
            alert('Student profile view would open here');
        }

        function loadFinanceData() {
            // Your original loadFinanceData function
        }

        function loadTeachersData() {
            // Your original loadTeachersData function
            loadTeachersTable();
        }

        function loadAttendanceByClass() {
            // Your original loadAttendanceByClass function
        }

        function switchTeacherView(view) {
            // Your original switchTeacherView function
        }

        function exportWithMultipleSheets() {
            // Your original exportWithMultipleSheets function
            alert('Excel export with multiple sheets feature');
        }

        function exportToExcel() {
            // Your original exportToExcel function
            alert('Export to Excel feature');
        }

        function saveSchoolSettings(event) {
            event.preventDefault();
            // Your original saveSchoolSettings function
        }

        function copySameAddress() {
            // Your original copySameAddress function
        }

        function copyTeacherSameAddress() {
            // Your original copyTeacherSameAddress function
        }

        // Add all your other original functions here...
        // Remember to copy them from your previous working version

    </script>
</body>
</html>